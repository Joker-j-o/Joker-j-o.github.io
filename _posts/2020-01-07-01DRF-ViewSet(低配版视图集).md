---
layout:     post                    # 使用的布局（不需要改）
title:      Python-DRF-Frame-ViewSet(低配视图集v1.3)           # 标题 
subtitle:   Joker #副标题
date:       2020-01-07              # 时间
author:     Joker                     # 作者
header-img: static/img/16.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
categories: [DRF-serializer]
---

# 视图集ViewSet

视图集：`将操作同一组资源相关的处理方法放在同一个类中，这个类叫做视图集。`
特点: `前面在实现图书管理的5个API时，需要两个类视图，而如果视图集，只需要一个即可。`

## 基本使用

1. `继承视图集父类ViewSet(继承自ViewSetMixin和APIView)。`
2. `视图集中的处理方法不再以对应的请求方式(get、post等)命名，而是以对应的操作(action)命名。`
   
   - `list：获取一组数据`
   - `create：新增一条数据`
   - `retrieve：获取指定的数据`
   - `update：更新指定的数据`
   - `destroy：删除指定的数据`

3. `在进行URL配置时，需要明确指明某个请求方式请求某个URL地址时，对应的是视图集中的哪个处理函数。`

## `低配版`

```python

import json
from rest_framework import viewsets

from booktest.models import BookInfo
from booktest.serializers import BookInfoSerializer

class BookInfoViewSet(viewsets.ViewSet):
    def list(self, request):
        books = BookInfo.objects.all()
        serializer = BookInfoSerializer(books, many=True)
        return Response(serializer.data)

    def create(self, request):
        serializer = BookInfoSerializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        serializer.save()
        return Response(serializer.data, status=status.HTTP_201_CREATED)

    def retrieve(self, request, pk):
        try:
            book = BookInfo.objects.get(id=pk)
        except BookInfo.DoesNotExist:
            raise Http404

        serializer = BookInfoSerializer(book)
        return Response(serializer.data)

    def update(self, request, pk):
        try:
            book = BookInfo.objects.get(id=pk)
        except BookInfo.DoesNotExist:
            raise Http404

        serializer = BookInfoSerializer(book, data=request.data)
        serializer.is_valid(raise_exception=True)
        serializer.save()
        return Response(serializer.data)

    def destroy(self, request, pk):
      try:
          book = BookInfo.objects.get(id=pk)
      except BookInfo.DoesNotExist:
          raise Http404

      book.delete()
      return Response(status=status.HTTP_204_NO_CONTENT)
```

> 注意: `因为此时使用的方法 不再是以前的 get post... 所以需要修改urls的配置`

#### `子应用中的 urls配置`

```python
from booktest import views

urlpatterns = [
    url(r'^books/$', views.BookInfoViewSet.as_view({
        'get':'list', # 传入的字典 根据key值 对应相对应的方法(函数)
        'post': 'create' # 传入的字典 根据key值 对应相对应的方法(函数)
    })),
    url(r'^books/(?P<pk>\d+)/$', views.BookInfoViewSet.as_view({
        'get': 'retrieve', # 传入的字典 根据key值 对应相对应的方法(函数)
        'put': 'update', # 传入的字典 根据key值 对应相对应的方法(函数)
        'delete': 'destroy' # 传入的字典 根据key值 对应相对应的方法(函数)
    }))
]

```

> 注意: `as_view({'key':'value'})` 根据`key值` 找到`相对应`的`请求方法`

# 常用视图集父类

## `ViewSet`
   - `继承自APIView与ViewSetMixin，作用也与APIView基本类似，提供了身份认证、权限校验、流量管理等。`

## `GenericViewSet`
   - `继承自GenericAPIView与ViewSetMixin，可以直接搭配Mixin扩展类使用。`

`每个版本不一样 建议都试一下`

# [GenericViewSet-v1.5](https://joker-j-o.github.io/drf-serializer/2020/01/07/02DRF-GenericViewSet(%E4%B8%AD%E9%85%8D%E7%89%88%E8%A7%86%E5%9B%BE%E9%9B%86).html)



~~Hey Miss Liu This Rose Is For You~~